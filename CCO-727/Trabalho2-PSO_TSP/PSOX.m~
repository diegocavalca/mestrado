    clear;
    clc;

    tic;
    
    % ATENCAO - Antes de executar este arquivo, se faz necessario ter executado o arquivo PrepareData.m
    
    % DADOS - Dataset (EIL51.tsp) e matriz de distancias do dataset
    load 'eil51.tsp';
    load 'distances.mat';
    
    % Dimensoes do dataset
    [rows,columns]=size(distances); 
        
    % Variaveis do PSO...
    swarmSize = 50;
    numIter = 50;
    X = zeros(swarmSize, rows); % Posicao (Particulas)
    V = cell(1, swarmSize); % Velocidade (Permutacoes)
    Vmax = 15;
    %f = inf(numIter, swarmSize); % Custos
    gBestScore = inf;
    pBestScore = inf(swarmSize, 1); 
    c1 = 0.4;
    c2 = 0.2;
    c3 = 0.4;

    %% Inicializacao
    % Nuvem...
    X(1,:) = 1:rows;
    for i=2:swarmSize;
        X(i,:) = randperm(rows, rows);
    end;
    %X(:,rows+1) = X(:,1); % Destino...

    %% Iteracoes...
    for t=1:numIter;
    %t=0;
    %while(gBestScore>500 && t<1000);
      %t = t + 1;
        
        % Avaliar particulas...
        for i=1:swarmSize;
            cost = Fitness(X(i,:), distances);
            if(pBestScore(i)>cost)
                pBestScore(i)=cost;
                pBest(i,:)=X(i,:);
            end
            if(gBestScore>cost)
                gBestScore=cost;
                gBest=X(i,:);
            end;
            %f(t,i) = cost;
        end;

        % Atualizar particulas (velocidade e posicao)...        
        for i=1:swarmSize;
        
            % Coeficientes de confianca...
            w = c1*rand(1);
            alpha = c2*rand(1);
            beta = c3*rand(1);
       
            % Deslocamento...
            Vd = Memory(V{i}, w);
            
            % Operadores de troca... 
             % (pBest - Xi)
            Vp = SwapOperators(pBest(i,:), X(i,:));
            Vp = Memory(Vp, alpha);
             % (gBest - Xi)
            Vg = SwapOperators(gBest, X(i,:));
            Vg = Memory(Vg, beta);
            
            %if(t == 5);error('I dont want to play anymore');end;
            
            %% Atualizando particula...
            % Velocidade....
            V{i} = [Vd; Vp; Vg];
            %V{i} = unique(V{i},'rows','stable');

            % Posicao
            X(i, :) = Movement(
            for v=1:size(V{i},1); 
                vel = V{i}(v,:); %V(v,:);
                X(i, [vel(1) vel(2)]) = X(i, [vel(2) vel(1)]); % Operacoes de troca...
            end;
            
        end;
        
        % Atualizando confianca...
        c1 = c1 * 0.95; 
        c2 = c2 * 1.01; 
        c3 = 1 - (c1+c2);
        
        histBest(t) = gBestScore;
        
    end;
    
    % Resultados...
    figure;
    plot(histBest);
    
    toc;
%
%    % Resultados...
%    [Pbest,idxPbest] = max(f);
%    [Gbest,idxGbest] = max(Pbest);  % Maior valor da funcao
%    % Melhor X
%    Xbest = X(idxPbest(1),:); 
%
%    % Plotando...
%    fig=figure; 
%    hax=axes; 
%
%    % Linha...
%    x=-2:0.1:2;
%    y= -x.^2 + 2*x + 11;
%    plot(x,y);
%
%    % Estrela...
%    hold on;
%    plot(Xbest(idxGbest), Gbest, '*');

    % Linha do pc
    %line([Xbest(idxGbest) Xbest(idxGbest)],get(hax,'YLim'),'Color',[1 0 0])